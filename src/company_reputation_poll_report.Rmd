---
title: "Company Reputation Poll Eda"
author: "Object of Type Closure is not Subsettable Group"
date: '2022-06-19'
output: html_document

knit: (function(input, ...) {
    rmarkdown::render(
      input,
      output_dir = "../"
    )
  })
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggpubr)
library(tidyverse)
library(ggplot2)
library(factoextra)
library(janitor)
library(here)
library(reactable)
library(tidyverse)
library(skimr)
library(ggbump)
library(tidyr)
library(cowplot)
library(wesanderson)
library(hrbrthemes)
library(dplyr)
library(viridis)
library(forcats)

```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction
Using a simple R script, the dataset is explored to present the most interesting and useful insights along with the questions they answer in a report format.


# Data
This data is the result of a partnership between Axios and Harris Poll to gauge the reputation of the most visible brands in America, based on 20 years of Harris Poll research.

- Methodology: The Axios Harris Poll 100 is based on a survey of 33,096 Americans in a nationally representative sample conducted March 11-April 3, 2022. The two-step process starts fresh each year by surveying the public’s top-of-mind awareness of companies that either excel or falter in society.

These 100 “most visible companies” are then ranked by a second group of Americans across the seven key dimensions of reputation to arrive at the ranking. If a company is not on the list, it did not reach a critical level of visibility to be measured

### Data Dictionary

# `poll.csv`

|variable  |class     |description |
|:---------|:---------|:-----------|
|company   |character | Company Name |
|industry  |character | Industry group |
|2022_rank |integer   | 2022 Rank (1 is better than 100) |
|2022_rq   |double    | 2022 RQ score. An RQ score is calculated by:  [ (Sum of ratings of each of the 9 attributes)/(the total number of attributes answered x 7) ]  x 100. Score ranges: 80 & above: Excellent; 75-79: Very Good ; 70-74: Good ; 65-69: Fair ; 55-64: Poor ; 50-54: Very Poor ; Below 50: Critical |
|change    |integer   | Change in rank from 2021         |
|year      |integer   | Year for that rank/RQ |
|rank      |integer   | Rank corresponding to the year|
|rq        |double    | RQ score corresponding to the year |

# `reputation.csv`
- All ranks in this for current year only

|variable  |class     |description |
|:---------|:---------|:-----------|
|company   |character | Company Name |
|industry  |character | Industry group |
|name      |character | Name of reputation category (P&S = Product and Service) |
|score     |double    | Score for reputation category |
|rank      |integer   | Rank for reputation category |



### Basic Information
```{r, echo = FALSE, message=FALSE}
# Get the Data

poll <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-05-31/poll.csv')
reputation <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-05-31/reputation.csv')

```


```{r , echo = FALSE}
reactable(poll)
```

```{r}
summary(poll)
```

By looking at Q1 and Q3 values we can observe the range of some metrics of the sample

# Poll EDA

```{r}

```


```{r , echo = FALSE}
reactable(reputation)
```

```{r}
summary(reputation)
```

By looking at Q1 and Q3 values we can observe the range of some metrics of the sample

# Reputation EDA

```{r}

```



# useful from the code. need to be rearrange

```{R}
library(tidyverse)
library(skimr)
library(ggbump)
library(tidyr)
library(ggplot2)
library(cowplot)
library(wesanderson)
library(hrbrthemes)
library(dplyr)
library(viridis)
library(forcats)
library(ggplot2)

# Read in with tidytuesdayR package
# Install from CRAN via: install.packages("tidytuesdayR")
# This loads the readme and all the datasets for the week of interest

# Get the Data

poll <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-05-31/poll.csv")
reputation <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-05-31/reputation.csv")


# extracting the results of 2022
df22 <- poll %>%
  select(company, industry, change, `2022_rank`, `2022_rq`) %>%
  mutate(year = 2022, rank = `2022_rank`, rq = `2022_rq`)

# removing old cols
df22 <- subset(df22, select = -c(`2022_rank`, `2022_rq`))
poll <- subset(poll, select = -c(`2022_rank`, `2022_rq`))

# merging results of 2022 with the other years to reduce cols
finalpoll <- rbind(poll, df22)


# filtering the industries

changeInrank <- finalpoll %>% drop_na(rank)
changeInrank <- changeInrank %>% drop_na(change)

Groceries <- changeInrank %>%
  filter(industry == "Groceries")

Ecommerce <- changeInrank %>%
  filter(industry == "Ecommerce")

Other <- changeInrank %>%
  filter(industry == "Other")

Logistics <- changeInrank %>%
  filter(industry == "Logistics")

Automotive <- changeInrank %>%
  filter(industry == "Automotive")

Financial_Services <- changeInrank %>%
  filter(industry == "Financial Services")

Industrial <- changeInrank %>%
  filter(industry == "Industrial")

Food_Beverage <- changeInrank %>%
  filter(industry == "Food & Beverage")

Consumer_Goods <- changeInrank %>%
  filter(industry == "Consumer Goods")

Pharma <- changeInrank %>%
  filter(industry == "Pharma")

Energy <- changeInrank %>%
  filter(industry == "Energy")

Tech <- changeInrank %>%
  filter(industry == "Tech")
```

```{R}
#*****Findings: The top 3 companies all belongs to the retail industry
# Plot top 10 of 2022 using Lollipop Chart along with industry
company_rank%>%ggplot( aes(x=company, y=rank,color=industry)) + 
  geom_point(size=3) + 
  geom_text(aes(label = rank), color ="white", size = 3)+
  geom_segment(aes(x=company, 
                   xend=company, 
                   y=0, 
                   yend=rank)) + 
  labs(title="The Highest Ranked Companies", 
       subtitle="Rank") +
  theme_light() +
  coord_flip() +
  theme(
    panel.grid.major.y = element_blank(),
    panel.border = element_blank(),
    axis.ticks.y = element_blank()
  )
```


```{r}
#***** Findings:best tech company is Samsung,  for eCommerce Amazon, for cars Toyota, for media we have Spotify
bestcompany %>% ggplot(aes(x = company, y = rank, color = industry)) +
  geom_point(size = 3) +
  geom_text(aes(label = rank), color = "black", size = 3) +
  geom_segment(aes(
    x = company,
    xend = company,
    y = 0,
    yend = rank
  )) +
  labs(
    title = "The Highest Ranked Companies For Each Industry",
    subtitle = "Rank"
  ) +
  theme_light() +
  coord_flip() +
  theme(
    panel.grid.major.y = element_blank(),
    panel.border = element_blank(),
    axis.ticks.y = element_blank()
  )
```

```{R}

# worst companies of each industry in 2022
worstcompany <- df22 %>%
  mutate(company = fct_reorder(company, rank)) %>%
  group_by(industry) %>%
  slice(which.max(rank))

#***** Findings:worst tech company is Twitter,  for eCommerce Wish, for cars General motors, for media we have Fox corporation
worstcompany %>% ggplot(aes(x = company, y = rank, color = industry)) +
  geom_point(size = 3) +
  geom_text(aes(label = rank), color = "black", size = 3) +
  geom_segment(aes(
    x = company,
    xend = company,
    y = 0,
    yend = rank
  )) +
  labs(
    title = "The Lowest Ranked Companies For Each Industry",
    subtitle = "Rank"
  ) +
  theme_light() +
  coord_flip() +
  theme(
    panel.grid.major.y = element_blank(),
    panel.border = element_blank(),
    axis.ticks.y = element_blank()
  )
```

```{R}
#***** Findings: The mode of the Rank for all companies in the yea 2022 is `Very Good`.
# meaning that most of companies in 2022 are rated as `Very Good`.
changeInrank$rq_cat <- cut(changeInrank$rq,
  breaks = c(0, 50, 55, 65, 70, 75, 80, Inf),
  labels = c("Critical", "Very Poor", "Poor", "Fair", "Good", "Very Good", "Excellent"),
  right = FALSE
)

changeInrank %>%
  filter(year == 2022) %>%
  distinct() %>%
  ggplot(aes(rq_cat)) +
    geom_bar(fill = "steelblue") +
    geom_text(
      position = "stack", stat = "count", aes(label = ..count..), vjust = -0.5
    )
```


# For the 2022
```{R}
# Changes in ranks over the years for each industry
#***** Findings: most tech companies has low rank in 2020 while it raises in 2021
# TODO: extract some intresting scocials or comapanies
Tech %>%
  filter(company == c("Facebook", "Twitter")) %>%
  ggplot(aes(year, rq, color = company)) +
  geom_path(alpha = 0.7) +
  geom_point(size = 3) +
  labs(title = "The RQ scale for some tech companies", x = "Years") +
  theme(plot.title = element_text(hjust = 0.5))
```

```{R}
#***** Findings: pharams companies has a low during 2020 during covid. However, in 2021 pfizer has a sharpe drop in rank
ggplot(Pharma, aes(year, rq, color = company)) +
  geom_path() +
  geom_point(size = 3) +
  labs(title = "The RQ Score for Pharma Companies", x = "Years") +
  theme(plot.title = element_text(hjust = 0.5))
```

```{R}
#***** Findings: Automotive companies in general after the year of 2019 has dropped in RQ scale
ggplot(Automotive, aes(year, rq, color = company)) +
  geom_path() +
  geom_point(size = 3) +
  labs(title = "The RQ Score for Automotive Comapnies", x = "Years") +
  theme(plot.title = element_text(hjust = 0.5))
```
```{R}
#***** Findings: groceries companies has rocked up after 2020
ggplot(Groceries, aes(year, rq, color = company)) +
  geom_path() +
  geom_point(size = 3) +
  labs(title = "The RQ Score for Groceries Comapnies", x = "Years") +
  theme(plot.title = element_text(hjust = 0.5))
```


```{r}
# stacked bar chart for score of tech companies in every name ** this cab be done for other industries
#***** Findings: johnson&johnson has lower scores in every aspect compared to Pfizer
phar <- reputation[reputation$industry == "Pharma", ]
ggplot(phar, aes(x = company, y = score, fill = name, label = score)) +
  geom_bar(stat = "identity") +
  geom_text(size = 3, position = position_stack(vjust = 0.5)) +
  labs(title = "The Pharma companies detailed scores for 2022") +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
#***** Findings: Honda has excellent score in most aspects except for citizenship the has is Toyota a better citizenship
auto <- reputation[reputation$industry == "Automotive", ]
ggplot(auto, aes(x = company, y = score, fill = name, label = cats)) +
  geom_bar(stat = "identity") +
  geom_text(size = 3, position = position_stack(vjust = 0.5)) +
  labs(title = "The Automotive Companies Detailed Scores for 2022") +
  theme(axis.text.x = element_text(angle = 40, vjust = 1, hjust = 1)) +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
#***** Findings: retails and tech have more companies with high score for culture
# rank of companies in term of names, plot top 10 in term of ethics
topculture <- culture %>%
  filter(rank < 11) %>%
  mutate(company = fct_reorder(company, desc(rank)))

topculture %>% ggplot(aes(x = company, y = rank, color = industry)) +
  geom_point(size = 3) +
  geom_text(aes(label = rank), color = "white", size = 3) +
  geom_segment(aes(
    x = company,
    xend = company,
    y = 0,
    yend = rank
  )) +
  labs(
    title = "The Highest Ranked Companies",
    subtitle = "Rank"
  ) +
  theme_light() +
  coord_flip() +
  theme(
    panel.grid.major.y = element_blank(),
    panel.border = element_blank(),
    axis.ticks.y = element_blank()
  )
```